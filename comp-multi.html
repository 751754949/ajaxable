<!DOCTYPE html>
<html lang="en-us" class="over-hidd">
  <head>
    <meta charset="UTF-8">
    <title>Ajaxable by artf</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Changa+One" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/fw.min.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/main.css">
    <script src="./js/ajaxable.min.js"></script>
  </head>

  <body>
    <section class="compare multip container bg-f demo-sect">
      <div class="desc">
        <h1>Multiple forms</h1>
        <span>Manage easily race conditions</span>
      </div>

      <div class="multi-cont width-all">
        <div class="columns">
          <div class="column col-6 cell1 col-md-12">
            <form action="end-ajaxable.html" id="form-mult1" class="form-comp ajaxable">
                <div class="form-group">
                    <label class="form-label" for="input-example-1">Name</label>
                    <input class="form-input" id="input-example-1" placeholder="Name" type="text" value="James">
                </div>
                <div class="form-group">
                    <label class="form-label" for="input-example-2">Email</label>
                    <input class="form-input" id="input-example-2" placeholder="Email" type="email" value="james@email.com" required>
                </div>
                <div class="form-group">
                    <button class="btn" type="submit">Submit</button>
                </div>
            </form>
          </div>
          <div class="column col-6 cell2 col-md-12">
            <form action="end-ajaxable.html" id="form-mult2" class="form-comp ajaxable">
                <div class="form-group">
                    <label class="form-label" for="input-example-1">Name</label>
                    <input class="form-input" id="input-example-1" placeholder="Name" type="text" value="Patrick">
                </div>
                <div class="form-group">
                    <label class="form-label" for="input-example-2">Email</label>
                    <input class="form-input" id="input-example-2" placeholder="Email" type="email" value="patrick@email.com" required>
                </div>
                <div class="form-group">
                    <button class="btn" type="submit">Submit</button>
                </div>
            </form>
          </div>
        </div>
        <div class="columns">
          <div class="column col-6 cell3 col-md-12">
            <form action="end-ajaxable.html" id="form-mult3" class="form-comp ajaxable">
                <div class="form-group">
                    <label class="form-label" for="input-example-1">Name</label>
                    <input class="form-input" id="input-example-1" placeholder="Name" type="text" value="Jessica">
                </div>
                <div class="form-group">
                    <label class="form-label" for="input-example-2">Email</label>
                    <input class="form-input" id="input-example-2" placeholder="Email" type="email" value="jessica@email.com" required>
                </div>
                <div class="form-group">
                    <button class="btn" type="submit">Submit</button>
                </div>
            </form>
          </div>
          <div class="column col-6 cell4 col-md-12">
            <form action="end-ajaxable.html" id="form-mult4" class="form-comp ajaxable">
                <div class="form-group">
                    <label class="form-label" for="input-example-1">Name</label>
                    <input class="form-input" id="input-example-1" placeholder="Name" type="text" value="Kevin">
                </div>
                <div class="form-group">
                    <label class="form-label" for="input-example-2">Email</label>
                    <input class="form-input" id="input-example-2" placeholder="Email" type="email" value="kevin@email.com" required>
                </div>
                <div class="form-group">
                    <button class="btn" type="submit">Submit</button>
                </div>
            </form>
          </div>
        </div>
      </div>

      <div class="cont-btn text-center">
        <button class="btn submit-all" id="submit-all">Submit all</button>
      </div>

      <div class="text-center">
          <pre class="code-multi">
ajaxable('.ajaxable')
.onStart(startLoading)
.onError(console.err)
.onEnd((par) => {
  if(par.activeRequests === 0){
    showModal('All done!');
  }
});</pre>
      </div>
    </section>

    <div class="modal modal-sm" id="modalEl">
      <div class="modal-overlay" onclick="hideModal()"></div>
      <div class="modal-container">
          <div class="modal-header">
              <button class="btn btn-clear float-right" onclick="hideModal()"></button>
              <div class="modal-title">Result demo</div>
          </div>
          <div class="modal-body">
              <div class="content" id="modal-content">
              </div>
          </div>
      </div>
    </div>

    <div class="modal modal-sm" id="modLoader">
      <div class="modal-overlay"></div>
      <div class="modal-container">
          <div class="modal-body">
              <div class="content loading" id="modal-content"></div>
          </div>
      </div>
    </div>

    <script>
      var counterTimer = 0;
      var modal = document.getElementById('modalEl');
      var modLoader = document.getElementById('modLoader');
      var modalBody = document.getElementById('modal-content');
      var btnAll = document.getElementById('submit-all');
      var hideModal = function() {
        modal.className = 'modal modal-sm';
      };
      var showModal = function(body) {
        modal.className = 'modal active modal-sm';
        modalBody.innerHTML = body || '';
      };

      var startLoading = function (params) {
        modLoader.className = 'modal modal-sm active';
        params.el.querySelector('.btn').className = 'btn loading';
      };

      var fakedDelay = function (res, params) {
        params.el.querySelector('.btn').className = 'btn';
        if(params.activeRequests == 0){
          modLoader.className = 'modal modal-sm';
          showModal('All done!');
        }
      };

      var ajaxEls = ajaxable('.ajaxable', {responseType: ''})
      .onStart(startLoading)
      .onError(console.err)
      .onResponse(function(res, params) {
        var active = params.activeRequests;
        setTimeout(function(){
          fakedDelay(res, params);
        }, active * 1000);
      });

      btnAll.onclick = function () {
        ajaxEls.submit();
      }

    </script>
  </body>
</html>
